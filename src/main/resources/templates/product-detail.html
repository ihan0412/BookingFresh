<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>상품 상세</title>
  <link rel="stylesheet" href="/css/common.css">
</head>
<body>

<!-- 헤더 포함 -->
<th:block th:replace="fragments/header :: header"></th:block>

<main class="container">

  <!-- ✅ 상품 이미지 영역 -->
  <section class="product-images">
    <img th:src="${product.photoUrl}" alt="상품사진" class="product-image">
  </section>

  <!-- ✅ 상품 정보 영역 -->
  <section class="product-info">
    <h2 th:text="${product.name}">상품명</h2>
    <p th:text="'중량: ' + ${product.weightPieces}">중량</p>
    <p th:text="'가격: ₩' + ${product.price}">가격</p>
  </section>

  <!-- ✅ 묶음 옵션 선택 -->
  <section class="bundle-options">
    <label for="bundle">묶음 선택:</label>
    <select id="bundle" name="bundle">
      <option value="1">1개</option>
      <option value="2">2개</option>
      <option value="3">3개</option>
      <option value="6">6개</option>
    </select>
    <p id="bundle-price">총 가격: ₩10,740</p> <!-- 초기값은 product.price -->
  </section>


  <!-- ✅ 수량 선택 및 버튼 -->
  <section class="purchase-actions">
    <form th:action="@{/cart/add}" method="post">
      <input type="hidden" name="productId" th:value="${product.id}">
      <label for="quantity">수량:</label>
      <input type="number" id="quantity" name="quantity" min="1" value="1">
      <button type="submit">장바구니 담기</button>
    </form>
  </section>

</main>

<!-- 푸터 포함 -->
<th:block th:replace="fragments/footer :: footer"></th:block>

</body>
<script th:if="${cartMessage != null}">
  alert([[${cartMessage}]]);
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const bundleSelect = document.getElementById("bundle");
    const priceDisplay = document.getElementById("bundle-price");

    // 서버에서 전달된 단일 상품 가격
    const unitPrice = /*[[${product.price}]]*/ 10740; // Thymeleaf가 렌더링 시 숫자로 치환

    function updatePrice() {
      const quantity = parseInt(bundleSelect.value);
      const totalPrice = unitPrice * quantity;
      priceDisplay.textContent = `총 가격: ₩${totalPrice.toLocaleString()}`;
    }

    bundleSelect.addEventListener("change", updatePrice);
    updatePrice(); // 초기 렌더링 시 가격 설정
  });
</script>

</html>
